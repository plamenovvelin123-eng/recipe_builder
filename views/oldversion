<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Recipes</title>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #E8FBF7;
    }

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 25px;
    height: 70px;
    background-color: #4ECDAF;
    color: white;
    font-size: 32px;
    font-weight: bold;
}

.header-left {
    font-size: 20px;
}

.header-title {
    font-size: 32px;
    font-weight: bold;
}

.header-right {
    display: flex;
    gap: 15px;
}

.header-btn {
    background: rgba(255,255,255,0.25);
    padding: 6px 15px;
    border-radius: 10px;
    text-decoration: none;
    font-size: 18px;
    color: white;
    transition: 0.2s ease;
}

.header-btn:hover {
    background: rgba(255,255,255,0.4);
}

.logout {
    background: rgba(255,80,80,0.3);
}

.logout:hover {
    background: rgba(255,80,80,0.5);
}

    /* CONTAINER */
    .recipes-container {
        width: 70%;
        margin: 40px auto;
        background: white;
        padding: 20px 30px;
        border-radius: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    /* ROW */
    .recipe-row {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 18px;
        padding: 15px;
        border-radius: 12px;
        border: 1px solid #d7e4e2;
        background: #ffffff;
    }

    .recipe-number {
        width: 25px;
        font-size: 18px;
        font-weight: bold;
        color: #444;
    }

    .recipe-image {
        width: 90px;
        height: 90px;
        border-radius: 10px;
        background: #f0f7f6;
        border: 1px solid #d7e4e2;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 12px;
        color: #555;
    }

    /* BUTTON BOXES */
    .recipe-button {
        flex: 1;
        background: #dff7ef;
        border: 1px solid #4ECDAF;
        border-radius: 10px;
        padding: 12px;
        text-align: center;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        transition: 0.2s;
    }
    .recipe-button:hover {
        background: #c4efdf;
    }

    /* ICON BUTTONS */
    .icon-btn {
        width: 35px;
        height: 35px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-size: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .edit-btn {
        background: #f4ffdf;
        color: #8ab200;
        border: 1px solid #d2e8a0;
    }
    .delete-btn {
        background: #ffe5e5;
        color: #d44a4a;
        border: 1px solid #efb4b4;
    }

    /* POPUP OVERLAY */
    .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.45);
        display: none;
        justify-content: center;
        align-items: center;
    }

    /* POPUP BOX */
    .popup-box {
        background: white;
        padding: 25px;
        width: 350px;
        border-radius: 15px;
        box-shadow: 0 3px 12px rgba(0,0,0,0.2);
    }

    .popup-title {
        font-size: 20px;
        margin-bottom: 10px;
        font-weight: bold;
    }

    .close-btn {
        margin-top: 15px;
        padding: 10px;
        background: #4ECDAF;
        color: white;
        border: none;
        width: 100%;
        border-radius: 10px;
        cursor: pointer;
    }

    .recipe-dish {
    min-width: 160px;
    font-size: 17px;
    font-weight: bold;
    color: #2d4f4f;
    display: flex;
    align-items: center; /* vertical center */
    }

    .add-recipe-btn {
        background: #dff7ef;
        color: black;
        border-radius: 10px;
        padding: 10px 20px;
        margin-bottom: 20px;
        border: 1px solid black;
    }
.back-btn {
    position: absolute;
    left: 20px;
    font-size: 20px;
    text-decoration: none;
    color: white;
    background: rgba(255,255,255,0.25);
    padding: 5px 12px;
    border-radius: 10px;
    transition: 0.2s;
}

.back-btn:hover {
    background: rgba(255,255,255,0.4);
}

.my-cards-btn {
    position: absolute;
    right: 20px;
    font-size: 20px;
    text-decoration: none;
    color: white;
    background: rgba(255,255,255,0.25);
    padding: 5px 12px;
    border-radius: 10px;
    transition: 0.2s;
}

/* Popup box update */
.popup-box {
    background: white;
    padding: 35px 30px;
    width: 380px;
    border-radius: 15px;
    box-shadow: 0 3px 12px rgba(0,0,0,0.25);
    position: relative;
    text-align: center;
}

/* X button */
.popup-close {
    position: absolute;
    top: 12px;
    right: 15px;
    background: transparent;
    border: none;
    font-size: 22px;
    cursor: pointer;
    color: #555;
    transition: 0.2s;
}
.popup-close:hover {
    color: #000;
}

/* Text centered */
.popup-center {
    margin-bottom: 20px;
    font-size: 22px;
    font-weight: bold;
}

/* Buttons container */
.edit-choice-buttons {
    display: flex;
    justify-content: center;
    gap: 20px;
}

/* Buttons style */
.choice-btn {
    background: #4ECDAF;
    color: white;
    border: none;
    padding: 10px 25px;
    border-radius: 10px;
    font-size: 14px;
    cursor: pointer;
    transition: 0.2s;
}
.choice-btn:hover {
    background: #3dbb9d;
}

.recipe-image img {
    width: 90px;
    height: 90px;
    object-fit: cover;
    border-radius: 10px;
}



</style>
</head> 

<body>
    
<div class="header">

    <div class="header-left">
        Hello, <%= username %>
    </div>

    <div class="header-title">
        My Recipes
    </div>

    <div class="header-right">
        <a href="/recipes/cart" class="header-btn">üõí Cart</a>
        <a href="/recipes/cards" class="header-btn">My Cards</a>
        <a href="http://localhost:3000/" class="header-btn logout">Logout</a>
    </div>

</div>



<div class="recipes-container">
    <button class="add-recipe-btn" onclick="openAddRecipePopup()">Add recipe</button>

    <% recipes.forEach((recipe, index) => { %>

        <div class="recipe-row">

            <div class="recipe-number"><%= index + 1 %>.</div>
            <div class="recipe-dish"><%= recipe.Dish %></div>
            <div class="recipe-image">
                    <% if (recipe.img) { %>
                    <img src="<%= recipe.img %>" alt="Recipe Image">
                    <% } else { %>
                        Img<% 
                    } %>
            </div>


            <div class="recipe-button" onclick="openPopup('<%= recipe.Instructions.join('<br>') %>', 'Instructions')">
                Instructions
            </div>

            <div class="recipe-button" onclick="openPopup('<%= recipe.Ingredients.join('<br>') %>', 'Ingredients')">
                Ingredients
            </div>
            <button class="icon-btn delete-btn" onclick="deleteRecipe('<%= recipe._id %>')">üóëÔ∏è</button>


            <button class="icon-btn edit-btn" onclick ="editrecipe('<%= recipe._id %>')">‚úèÔ∏è</button>
        

        </div>

    <% }) %>

</div>

<div id="popup" class="popup-overlay">
    <div class="popup-box">
        <div id="popup-title" class="popup-title"></div>

        <div id="popup-content"></div>

        <button class="close-btn" onclick="closePopup()">Close</button>
    </div>
</div>
<script>
    function openPopup(content, title) {
        document.getElementById("popup-title").innerHTML = title;
        document.getElementById("popup-content").innerHTML = content;
        document.getElementById("popup").style.display = "flex";
    }

    function closePopup() {
        document.getElementById("popup").style.display = "none";
    }
    function deleteRecipe(id) {
    fetch(`/recipes/${id}`, {
        method: "DELETE"
    })
    .then(() => location.reload());
    }
    let currentEditId = null;
    let currentEditType = null;

    function editrecipe(id) {
        currentEditId = id;
        document.getElementById("editChoicePopup").style.display = "flex";
}
    function saveEdit() {
    const newText = document.getElementById("editTextArea").value;

    const data = {};
    data[currentEditType] = newText.split("\n");

    fetch(`/recipes/${currentEditId}`, {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    })
    .then(() => location.reload());
}
function chooseEdit(type) {
    currentEditType = type;
    document.getElementById("editChoicePopup").style.display = "none";
    document.getElementById("editTextTitle").innerText = "Editing " + type;
    document.getElementById("editTextPopup").style.display = "flex";
}
function add_recipe() {
    const dish = document.getElementById("newRecipeInput").value;
    const ingredients = document.getElementById("newRecipeIngredients").value.split("\n");
    const instructions = document.getElementById("newRecipeInstructions").value.split("\n");
    const imgFile = document.getElementById("newRecipeImg").files[0];

    let formData = new FormData();
    formData.append("Dish", dish);

    ingredients.forEach(ing => formData.append("Ingredients[]", ing));
    instructions.forEach(ins => formData.append("Instructions[]", ins));

    if (imgFile) formData.append("img", imgFile);

    fetch('/recipes', {
        method: "POST",
        body: formData,
        credentials: "include"
    })
    .then(() => location.reload());
}


function openAddRecipePopup() {
    document.getElementById("addRecipePopup").style.display = "flex";
}

function closeAddRecipePopup() {
    document.getElementById("addRecipePopup").style.display = "none";
}

function closeEditPopup(){
    document.getElementById("editChoicePopup").style.display = "none";
}

</script>
<div id="editChoicePopup" class="popup-overlay" style="display:none;">
    <div class="popup-box">

        <button class="popup-close" onclick="closeEditPopup()">‚úñ</button>

        <h2 class="popup-center">What do you want to edit?</h2>

        <div class="edit-choice-buttons">
            <button class="choice-btn" onclick="chooseEdit('Instructions')">Instructions</button>
            <button class="choice-btn" onclick="chooseEdit('Ingredients')">Ingredients</button>
        </div>

    </div>
</div>
<div id="editTextPopup" class="popup-overlay" style="display:none;">
    <div class="popup-box">
        <h2 id="editTextTitle"></h2>

        <textarea id="editTextArea"
                  style="width:100%; height:140px; margin-top:15px; font-size:15px;"></textarea>

        <button class="close-btn" onclick="saveEdit()">Save</button>
    </div>
</div>
<!-- POPUP ‚Äî Add Recipe -->
<div id="addRecipePopup" class="popup-overlay" style="display:none;">
    <div class="popup-box">
        
        <div class="popup-title">Add New Recipe</div>

        <input id="newRecipeInput"
               type="text"
               placeholder="Dish Name"
               style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:8px;">

        <textarea id="newRecipeIngredients"
                  placeholder="For better readability, please list the Ingredients one per line, for example: ‚Äò1. Tomato‚Äô"
                  style="width:100%; height:80px; padding:10px; border:1px solid #ccc; border-radius:8px;"></textarea>

        <textarea id="newRecipeInstructions"
                  placeholder="For better readability, please list the instructions one per line, for example: ‚Äò1. Boil water‚Äô, ‚Äò2. Add salt‚Äô."
                  style="width:100%; height:80px; margin-top:10px; padding:10px; border:1px solid #ccc; border-radius:8px;"></textarea>
            <input id="newRecipeImg"
                type="file"
                accept="image/*"
                style="width:100%; padding:10px; border:1px solid #ccc; border-radius:8px; margin-bottom:10px;">


        <button class="close-btn" style="margin-top:15px;" onclick="add_recipe()">Save</button>
        <button class="close-btn" style ="background:#aaa; margin-top:10px;" onclick="closeAddRecipePopup()">Close</button>
        
    </div>
</div>


</body>
</html>
